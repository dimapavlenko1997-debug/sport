<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Фитнес-трекер</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2ecc71;
            --danger: #e74c3c;
            --dark: #2c3e50;
            --light: #ecf0f1;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 30px 0;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .card h2 {
            color: var(--primary);
            margin-bottom: 15px;
            border-bottom: 2px solid var(--light);
            padding-bottom: 10px;
        }
        
        .input-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .btn-danger {
            background-color: var(--danger);
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        .btn-success {
            background-color: var(--secondary);
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: var(--light);
            font-weight: 600;
        }
        
        .chart-container {
            height: 300px;
            margin-top: 20px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .summary-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .summary-card h3 {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .summary-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .summary-card .unit {
            font-size: 1rem;
            color: #7f8c8d;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .input-section {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Фитнес-трекер</h1>
            <p>Отслеживайте свой прогресс в питании, тренировках и весе</p>
        </header>
        
        <div class="summary-cards">
            <div class="summary-card">
                <h3>Текущий вес</h3>
                <div class="value" id="current-weight">-</div>
                <div class="unit">кг</div>
            </div>
            <div class="summary-card">
                <h3>Калории сегодня</h3>
                <div class="value" id="today-calories">-</div>
                <div class="unit">ккал</div>
            </div>
            <div class="summary-card">
                <h3>Сожжено калорий</h3>
                <div class="value" id="burned-calories">-</div>
                <div class="unit">ккал</div>
            </div>
            <div class="summary-card">
                <h3>Баланс калорий</h3>
                <div class="value" id="calorie-balance">-</div>
                <div class="unit">ккал</div>
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="nutrition">Питание</div>
            <div class="tab" data-tab="workouts">Тренировки</div>
            <div class="tab" data-tab="weight">Вес</div>
            <div class="tab" data-tab="progress">Прогресс</div>
        </div>
        
        <div class="tab-content active" id="nutrition-tab">
            <div class="card">
                <h2>Добавить прием пищи</h2>
                <div class="input-section">
                    <div class="form-group">
                        <label for="food-name">Название продукта</label>
                        <input type="text" id="food-name" placeholder="Например, Куриная грудка">
                    </div>
                    <div class="form-group">
                        <label for="food-calories">Калории</label>
                        <input type="number" id="food-calories" placeholder="ккал">
                    </div>
                    <div class="form-group">
                        <label for="food-protein">Белки (г)</label>
                        <input type="number" id="food-protein" placeholder="г">
                    </div>
                    <div class="form-group">
                        <label for="food-carbs">Углеводы (г)</label>
                        <input type="number" id="food-carbs" placeholder="г">
                    </div>
                    <div class="form-group">
                        <label for="food-fat">Жиры (г)</label>
                        <input type="number" id="food-fat" placeholder="г">
                    </div>
                </div>
                <button id="add-food" class="btn-success">Добавить прием пищи</button>
            </div>
            
            <div class="card">
                <h2>История питания</h2>
                <table id="food-log">
                    <thead>
                        <tr>
                            <th>Продукт</th>
                            <th>Калории</th>
                            <th>Белки</th>
                            <th>Углеводы</th>
                            <th>Жиры</th>
                            <th>Дата</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Данные будут добавляться через JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="tab-content" id="workouts-tab">
            <div class="card">
                <h2>Добавить тренировку</h2>
                <div class="input-section">
                    <div class="form-group">
                        <label for="workout-type">Тип тренировки</label>
                        <select id="workout-type">
                            <option value="cardio">Кардио</option>
                            <option value="strength">Силовая</option>
                            <option value="flexibility">Растяжка</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="workout-name">Название упражнения</label>
                        <input type="text" id="workout-name" placeholder="Например, Бег">
                    </div>
                    <div class="form-group">
                        <label for="workout-duration">Продолжительность (мин)</label>
                        <input type="number" id="workout-duration" placeholder="минут">
                    </div>
                    <div class="form-group">
                        <label for="workout-calories">Сожжено калорий</label>
                        <input type="number" id="workout-calories" placeholder="ккал">
                    </div>
                </div>
                <button id="add-workout" class="btn-success">Добавить тренировку</button>
            </div>
            
            <div class="card">
                <h2>История тренировок</h2>
                <table id="workout-log">
                    <thead>
                        <tr>
                            <th>Тип</th>
                            <th>Упражнение</th>
                            <th>Продолжительность</th>
                            <th>Калории</th>
                            <th>Дата</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Данные будут добавляться через JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="tab-content" id="weight-tab">
            <div class="card">
                <h2>Добавить запись о весе</h2>
                <div class="input-section">
                    <div class="form-group">
                        <label for="weight-value">Вес (кг)</label>
                        <input type="number" id="weight-value" placeholder="кг" step="0.1">
                    </div>
                    <div class="form-group">
                        <label for="weight-date">Дата</label>
                        <input type="date" id="weight-date">
                    </div>
                </div>
                <button id="add-weight" class="btn-success">Добавить вес</button>
            </div>
            
            <div class="card">
                <h2>История веса</h2>
                <table id="weight-log">
                    <thead>
                        <tr>
                            <th>Дата</th>
                            <th>Вес</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Данные будут добавляться через JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="tab-content" id="progress-tab">
            <div class="dashboard">
                <div class="card">
                    <h2>Прогресс веса</h2>
                    <div class="chart-container">
                        <canvas id="weight-chart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <h2>Баланс калорий</h2>
                    <div class="chart-container">
                        <canvas id="calories-chart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h2>Статистика за неделю</h2>
                <div class="chart-container">
                    <canvas id="weekly-chart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Данные приложения
        let fitnessData = {
            nutrition: [],
            workouts: [],
            weight: []
        };

        // Загрузка данных из localStorage
        function loadData() {
            const savedData = localStorage.getItem('fitnessTrackerData');
            if (savedData) {
                fitnessData = JSON.parse(savedData);
            }
            updateAllDisplays();
        }

        // Сохранение данных в localStorage
        function saveData() {
            localStorage.setItem('fitnessTrackerData', JSON.stringify(fitnessData));
            updateAllDisplays();
        }

        // Обновление всех отображений
        function updateAllDisplays() {
            updateNutritionTable();
            updateWorkoutTable();
            updateWeightTable();
            updateSummaryCards();
            updateCharts();
        }

        // Обновление таблицы питания
        function updateNutritionTable() {
            const tbody = document.querySelector('#food-log tbody');
            tbody.innerHTML = '';
            
            // Сортируем по дате (новые сверху)
            const sortedNutrition = [...fitnessData.nutrition].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedNutrition.forEach((item, index) => {
                const originalIndex = fitnessData.nutrition.findIndex(n => 
                    n.date === item.date && n.name === item.name && n.calories === item.calories
                );
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.calories}</td>
                    <td>${item.protein || '-'}</td>
                    <td>${item.carbs || '-'}</td>
                    <td>${item.fat || '-'}</td>
                    <td>${formatDate(item.date)}</td>
                    <td>
                        <button class="btn-danger delete-food" data-index="${originalIndex}">Удалить</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // Добавляем обработчики для кнопок удаления
            document.querySelectorAll('.delete-food').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    fitnessData.nutrition.splice(index, 1);
                    saveData();
                });
            });
        }

        // Обновление таблицы тренировок
        function updateWorkoutTable() {
            const tbody = document.querySelector('#workout-log tbody');
            tbody.innerHTML = '';
            
            const sortedWorkouts = [...fitnessData.workouts].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedWorkouts.forEach((item, index) => {
                const originalIndex = fitnessData.workouts.findIndex(w => 
                    w.date === item.date && w.name === item.name && w.calories === item.calories
                );
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${getWorkoutTypeName(item.type)}</td>
                    <td>${item.name}</td>
                    <td>${item.duration} мин</td>
                    <td>${item.calories}</td>
                    <td>${formatDate(item.date)}</td>
                    <td>
                        <button class="btn-danger delete-workout" data-index="${originalIndex}">Удалить</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // Добавляем обработчики для кнопок удаления
            document.querySelectorAll('.delete-workout').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    fitnessData.workouts.splice(index, 1);
                    saveData();
                });
            });
        }

        // Обновление таблицы веса
        function updateWeightTable() {
            const tbody = document.querySelector('#weight-log tbody');
            tbody.innerHTML = '';
            
            const sortedWeight = [...fitnessData.weight].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedWeight.forEach((item, index) => {
                const originalIndex = fitnessData.weight.findIndex(w => w.date === item.date && w.value === item.value);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(item.date)}</td>
                    <td>${item.value} кг</td>
                    <td>
                        <button class="btn-danger delete-weight" data-index="${originalIndex}">Удалить</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // Добавляем обработчики для кнопок удаления
            document.querySelectorAll('.delete-weight').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    fitnessData.weight.splice(index, 1);
                    saveData();
                });
            });
        }

        // Обновление карточек с суммарной информацией
        function updateSummaryCards() {
            // Текущий вес (последняя запись)
            if (fitnessData.weight.length > 0) {
                const sortedWeight = [...fitnessData.weight].sort((a, b) => new Date(b.date) - new Date(a.date));
                document.getElementById('current-weight').textContent = sortedWeight[0].value;
            } else {
                document.getElementById('current-weight').textContent = '-';
            }
            
            // Калории за сегодня
            const today = new Date().toISOString().split('T')[0];
            const todayNutrition = fitnessData.nutrition.filter(item => item.date === today);
            const todayCalories = todayNutrition.reduce((sum, item) => sum + parseInt(item.calories), 0);
            document.getElementById('today-calories').textContent = todayCalories;
            
            // Сожжено калорий за сегодня
            const todayWorkouts = fitnessData.workouts.filter(item => item.date === today);
            const burnedCalories = todayWorkouts.reduce((sum, item) => sum + parseInt(item.calories), 0);
            document.getElementById('burned-calories').textContent = burnedCalories;
            
            // Баланс калорий
            const calorieBalance = todayCalories - burnedCalories;
            document.getElementById('calorie-balance').textContent = calorieBalance;
            document.getElementById('calorie-balance').style.color = calorieBalance > 0 ? '#e74c3c' : '#2ecc71';
        }

        // Обновление графиков
        function updateCharts() {
            updateWeightChart();
            updateCaloriesChart();
            updateWeeklyChart();
        }

        // График веса
        function updateWeightChart() {
            const ctx = document.getElementById('weight-chart').getContext('2d');
            
            // Сортируем записи по дате
            const sortedWeight = [...fitnessData.weight].sort((a, b) => new Date(a.date) - new Date(b.date));
            
            const labels = sortedWeight.map(item => formatDate(item.date));
            const data = sortedWeight.map(item => item.value);
            
            // Если график уже существует, уничтожаем его
            if (window.weightChart) {
                window.weightChart.destroy();
            }
            
            if (sortedWeight.length > 0) {
                window.weightChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Вес (кг)',
                            data: data,
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: false
                            }
                        }
                    }
                });
            }
        }

        // График калорий
        function updateCaloriesChart() {
            const ctx = document.getElementById('calories-chart').getContext('2d');
            
            // Группируем данные по дате
            const dates = [...new Set([...fitnessData.nutrition.map(item => item.date), ...fitnessData.workouts.map(item => item.date)])].sort();
            
            const consumedData = dates.map(date => {
                const dayNutrition = fitnessData.nutrition.filter(item => item.date === date);
                return dayNutrition.reduce((sum, item) => sum + parseInt(item.calories), 0);
            });
            
            const burnedData = dates.map(date => {
                const dayWorkouts = fitnessData.workouts.filter(item => item.date === date);
                return dayWorkouts.reduce((sum, item) => sum + parseInt(item.calories), 0);
            });
            
            const balanceData = dates.map((date, index) => consumedData[index] - burnedData[index]);
            
            // Если график уже существует, уничтожаем его
            if (window.caloriesChart) {
                window.caloriesChart.destroy();
            }
            
            if (dates.length > 0) {
                window.caloriesChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: dates.map(date => formatDate(date)),
                        datasets: [
                            {
                                label: 'Потреблено',
                                data: consumedData,
                                backgroundColor: 'rgba(52, 152, 219, 0.7)'
                            },
                            {
                                label: 'Сожжено',
                                data: burnedData,
                                backgroundColor: 'rgba(46, 204, 113, 0.7)'
                            },
                            {
                                label: 'Баланс',
                                data: balanceData,
                                type: 'line',
                                borderColor: 'rgba(231, 76, 60, 0.8)',
                                backgroundColor: 'rgba(231, 76, 60, 0.1)',
                                borderWidth: 2,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
        }

        // Недельный график
        function updateWeeklyChart() {
            const ctx = document.getElementById('weekly-chart').getContext('2d');
            
            // Получаем данные за последние 7 дней
            const today = new Date();
            const lastWeek = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                lastWeek.push(date.toISOString().split('T')[0]);
            }
            
            const nutritionData = lastWeek.map(date => {
                const dayNutrition = fitnessData.nutrition.filter(item => item.date === date);
                return dayNutrition.reduce((sum, item) => sum + parseInt(item.calories), 0);
            });
            
            const workoutData = lastWeek.map(date => {
                const dayWorkouts = fitnessData.workouts.filter(item => item.date === date);
                return dayWorkouts.reduce((sum, item) => sum + parseInt(item.calories), 0);
            });
            
            // Если график уже существует, уничтожаем его
            if (window.weeklyChart) {
                window.weeklyChart.destroy();
            }
            
            window.weeklyChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: lastWeek.map(date => formatDate(date)),
                    datasets: [
                        {
                            label: 'Потреблено калорий',
                            data: nutritionData,
                            backgroundColor: 'rgba(52, 152, 219, 0.7)'
                        },
                        {
                            label: 'Сожжено калорий',
                            data: workoutData,
                            backgroundColor: 'rgba(46, 204, 113, 0.7)'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Вспомогательные функции
        function getWorkoutTypeName(type) {
            const types = {
                'cardio': 'Кардио',
                'strength': 'Силовая',
                'flexibility': 'Растяжка'
            };
            return types[type] || type;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU');
        }

        function getTodayDate() {
            return new Date().toISOString().split('T')[0];
        }

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            // Загружаем данные
            loadData();
            
            // Устанавливаем сегодняшнюю дату по умолчанию для полей ввода
            document.getElementById('weight-date').value = getTodayDate();
            
            // Обработчики для вкладок
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Убираем активный класс у всех вкладок
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // Добавляем активный класс к текущей вкладке
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
            
            // Обработчики для кнопок добавления
            document.getElementById('add-food').addEventListener('click', function() {
                const name = document.getElementById('food-name').value;
                const calories = document.getElementById('food-calories').value;
                const protein = document.getElementById('food-protein').value;
                const carbs = document.getElementById('food-carbs').value;
                const fat = document.getElementById('food-fat').value;
                
                if (name && calories) {
                    fitnessData.nutrition.push({
                        name,
                        calories: parseInt(calories),
                        protein: protein ? parseInt(protein) : null,
                        carbs: carbs ? parseInt(carbs) : null,
                        fat: fat ? parseInt(fat) : null,
                        date: getTodayDate()
                    });
                    
                    // Очищаем поля ввода
                    document.getElementById('food-name').value = '';
                    document.getElementById('food-calories').value = '';
                    document.getElementById('food-protein').value = '';
                    document.getElementById('food-carbs').value = '';
                    document.getElementById('food-fat').value = '';
                    
                    saveData();
                } else {
                    alert('Пожалуйста, заполните хотя бы название продукта и количество калорий');
                }
            });
            
            document.getElementById('add-workout').addEventListener('click', function() {
                const type = document.getElementById('workout-type').value;
                const name = document.getElementById('workout-name').value;
                const duration = document.getElementById('workout-duration').value;
                const calories = document.getElementById('workout-calories').value;
                
                if (name && duration && calories) {
                    fitnessData.workouts.push({
                        type,
                        name,
                        duration: parseInt(duration),
                        calories: parseInt(calories),
                        date: getTodayDate()
                    });
                    
                    // Очищаем поля ввода
                    document.getElementById('workout-name').value = '';
                    document.getElementById('workout-duration').value = '';
                    document.getElementById('workout-calories').value = '';
                    
                    saveData();
                } else {
                    alert('Пожалуйста, заполните все поля');
                }
            });
            
            document.getElementById('add-weight').addEventListener('click', function() {
                const value = document.getElementById('weight-value').value;
                const date = document.getElementById('weight-date').value;
                
                if (value && date) {
                    fitnessData.weight.push({
                        value: parseFloat(value),
                        date
                    });
                    
                    // Очищаем поля ввода
                    document.getElementById('weight-value').value = '';
                    document.getElementById('weight-date').value = getTodayDate();
                    
                    saveData();
                } else {
                    alert('Пожалуйста, заполните все поля');
                }
            });
        });
    </script>
</body>
</html>